<!DOCTYPE html>
<html lang="en">
<head>
          <title>Vorsprung durch Informatik</title>
        <meta charset="utf-8" />



    <meta name="tags" contents="software" />
    <meta name="tags" contents="webserver" />
    <meta name="tags" contents="webapps" />
    <meta name="tags" contents="Python" />
    <meta name="tags" contents="Flask" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="../../">Vorsprung durch Informatik <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="../../2013/03/how-to-deploy-flask-applications-to-apache-webserver.html" rel="bookmark"
         title="Permalink to How to deploy Flask applications to Apache webserver">How to deploy Flask applications to Apache webserver</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2013-03-06T01:00:00">
      06/mar/2013 01:00
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="../../author/csparpa.html">csparpa</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <h3>Introduction</h3>
<p>This is a simple guide explaining how I managed to configure Apache 2.2 httpd server on a Windows 2012 server platform so that it can serve a Python webapplication I wrote using the <a href="http://flask.pocoo.org/">Flask micro-framework</a>.  </p>
<p>The guide is valid, with a very little modification, also on Linux environments (you geeks know how to do)</p>
<h3>Why I needed to to this</h3>
<p>I developed this application at work and I‘ve been serving it from the beginning via the Flask's built-in minimal webserver: unfortunately this  is not enough for production stage as I need a more robust server with SSL capabilities, which Flask's has not. This was my first time in deploying a Python webapp... So, after googling a bit and reading the <a href="http://flask.pocoo.org/docs/deploying/">Flask deployment notes</a>, I came up with the answer: what I needed was a WSGI-compliant server running on my target platform, a Windows 2012 server. The natural choice to me was to enable the WSGI module on the "good ole" Apache webserver, which I'm experienced with.</p>
<h3>Steps</h3>
<h4>1. Flask app</h4>
<p>We choose a folder in which we place the Python code. For instance,  </p>
<div class="highlight"><pre><span class="nl">D:</span><span class="err">\</span><span class="n">webapps</span><span class="err">\</span><span class="n">test</span>
</pre></div>


<p>In this folder we create the real Flask webapplication that we want to deploy (file <code>test.py</code>):  </p>
<div class="highlight"><pre><span class="c"># test.py</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/hello&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&#39;Hello &#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;!&#39;</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>


<p>The Apache server won't be aware of <code>test.py</code> at all. What you need to do now is to write in the same folder a Python file named <code>test.wsgi</code> that we will link into the webserver's configuration: the code in this file will import the main Flask application object (built in our case as a singleton) and will be actually executed by the WSGI module of Apache. In the code, it is vital that you DON'T change the name of the "application" variable, as it is exactly what the server expects to find. Also please note that we are extending the Python classes path to include our own webapplication's folder.  </p>
<p>This is <code>test.wsgi</code>:</p>
<div class="highlight"><pre><span class="c"># test.wsgi</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c">#Expand Python classes path with your app&#39;s path</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;d:/webapps/test&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">test</span> <span class="kn">import</span> <span class="n">app</span>

<span class="c">#Put logging code (and imports) here ...</span>

<span class="c">#Initialize WSGI app object</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">app</span>
</pre></div>


<p>As an additional remark, if you want to put any logging code (e.g: file/e-mail/console loggers) into your Flask app, you must put it before the <code>if __name__ == ‘__main__'</code> block, otherwise it won't log anything! Add your loggers to the app object.  </p>
<p>More on this on the <a href="http://flask.pocoo.org/docs/0.10/api/#flask.Flask.logger">Flask documentation</a></p>
<h4>2. Apache setup</h4>
<p>Ok, what's next? Now it's all about installing and properly configuring Apache.</p>
<p>First: install Apache webserver. I <a href="http://apache.panu.it//httpd/binaries/win32/httpd-2.2.22-win32-x86-openssl-0.9.8t.msi">downloaded</a> and executed the .msi installer. Apache was installed at:</p>
<div class="highlight"><pre>&quot;C:\Program Files (x86)\Apache Software Foundation\Apache2.2&quot;
</pre></div>


<p>Second: install the WSGI Apache module. Pay attention to download the module compiled for your specific combination of platform and Python and Apache versions: I downloaded <a href="https://code.google.com/p/modwsgi/downloads/detail?name=mod_wsgi-win32-ap22py27-3.3.so">this module</a>. Once downloaded, rename the <code>.so</code> file into <code>mod_wsgi.so</code> and put it under the <code>modules</code> subfolder of your Apache installation folder. Then you have to tell Apache to use it: open in a text editor the <code>httpd.config</code> file which is under the <code>conf</code> subfolder and add the following line at the bottom:  </p>
<div class="highlight"><pre>LoadModule wsgi_module modules/mod_wsgi.so
</pre></div>


<p>Third: restart Apache.</p>
<p>Now Apache is ready to serve WSGI webapplications.  </p>
<p>What is left to do is to tell about where our application is and match it to a URL alias. It's child's play: open in a text editor the <code>httpd.config</code> file we used before and add these lines to the bottom:  </p>
<div class="highlight"><pre>&lt;Directory d:/webapps/test&gt;
    Order allow,deny
    Allow from all
&lt;/Directory&gt;
WSGIScriptAlias /flasktest d:/webapps/test/test.wsgi
</pre></div>


<p>(nevertheless, I prefer to place the per-virtual-host or per-alias configurations' stuff into separate files and then use an Include directive into the main <code>httpd.conf</code>).  </p>
<p>Now restart Apache again and if you open a browser and point it to:</p>
<div class="highlight"><pre>http://localhost/flasktest/hello?name=claudio
</pre></div>


<p>and you should see the webapp's greetings!</p>
<h3>Further references</h3>
<ul>
<li><a href="https://code.google.com/p/modwsgi/wiki/QuickConfigurationGuide">This guide</a> helped me a lot in understanding how to setup Apache WSGI.</li>
<li>I also found <a href="https://beagle.whoi.edu/redmine/projects/ibt/wiki/Deploying_Flask_Apps_with_Apache_and_Mod_WSGI?version=3">this tutorial</a> which is far more comprehensive than mine and covers Flask deployment on Apache on Debian/Ubuntu environments</li>
</ul>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>